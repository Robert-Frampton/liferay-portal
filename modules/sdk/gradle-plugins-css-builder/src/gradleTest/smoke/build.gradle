import java.util.regex.Matcher

apply plugin: "com.liferay.css.builder"
apply plugin: "java"

task runGradleTest

repositories {
	maven {
		url "https://cdn.lfrs.sl/repository.liferay.com/nexus/content/groups/public"
	}
}

runGradleTest {
	dependsOn classes

	doLast {
		File dir = file("src/main/resources/css/.sass-cache")

		for (String fileName in ["main.css", "main_rtl.css"]) {
			File generatedFile = new File(dir, fileName)

			assert generatedFile.exists()
		}

		File mainCssFile = new File(dir, "main.css")

		Matcher matcher = mainCssFile.text =~ /@import\s+url\s*\(\s*"(.+\.css\?t=\d+)"\s*\)\s*;/

		assert matcher.count == 3
	}
}